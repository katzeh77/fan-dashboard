<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 LED Controller</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body{
  font-family: Arial;
  background:#111;
  color:#fff;
  text-align:center;
}
.container{
  width:400px;
  margin:auto;
  margin-top:20px;
  padding:20px;
  background:#222;
  border-radius:10px;
}
input{
  width:80%;
}
button{
  margin-top:10px;
  padding:8px 15px;
  cursor:pointer;
}
.section{
  margin-top:20px;
  padding:10px;
  background:#333;
  border-radius:8px;
}
</style>
</head>
<body>

<div class="container">
<h2>ESP32 LED Controller</h2>

<!-- ================= MANUAL ================= -->
<div class="section">
<h3>MODE MANUAL</h3>
<input type="range" min="0" max="100" value="0" id="manualSlider" 
oninput="manualControl(this.value)">
<p>Brightness: <span id="manualVal">0</span>%</p>
<button onclick="setManualMode()">Aktifkan Manual</button>
</div>

<!-- ================= AUTO ================= -->
<div class="section">
<h3>MODE OTOMATIS</h3>

<p>06.30 - 07.30</p>
<input type="number" id="a1" min="0" max="100">

<p>07.31 - 09.00</p>
<input type="number" id="a2" min="0" max="100">

<p>09.01 - 13.00</p>
<input type="number" id="a3" min="0" max="100">

<p>13.01 - 14.30</p>
<input type="number" id="a4" min="0" max="100">

<p>14.31 - 16.00</p>
<input type="number" id="a5" min="0" max="100">

<button onclick="saveAuto()">SAVE AUTO</button>
<button onclick="setAutoMode()">Aktifkan Auto</button>

<p id="autoStatus"></p>
</div>

<hr>
<p>Status Mode: <span id="modeStatus">-</span></p>

</div>

<script>

// ================= MQTT =================
const client = mqtt.connect("wss://broker.emqx.io:8084/mqtt");

client.on("connect",function(){
  console.log("MQTT Connected");
  client.subscribe("status/mode");
  client.subscribe("status/auto");
});

client.on("message",function(topic,message){
  let msg = message.toString();

  if(topic==="status/mode"){
    document.getElementById("modeStatus").innerText = msg;
  }

  if(topic==="status/auto"){
    document.getElementById("autoStatus").innerText = msg;
  }
});

// ================= MANUAL =================
function manualControl(val){
  document.getElementById("manualVal").innerText = val;
  let pwm = Math.round(val*2.55);
  client.publish("led/1", pwm.toString());
}

function setManualMode(){
  client.publish("mode","manual");
}

// ================= AUTO =================
function saveAuto(){

  for(let i=1;i<=5;i++){
    let val = parseInt(document.getElementById("a"+i).value);
    if(isNaN(val)) val = 0;
    val = Math.min(100,Math.max(0,val));

    let pwm = Math.round(val*2.55);
    client.publish("auto/set"+i, pwm.toString());
  }

  client.publish("auto/save","1");
}

function setAutoMode(){
  client.publish("mode","auto");
}

</script>

</body>
</html>
