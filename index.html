<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LED Controller</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body{font-family:Arial;background:#111;color:#fff;text-align:center}
.section{margin:20px;padding:15px;background:#222;border-radius:10px}
button{padding:8px 15px;margin:5px}
input{width:60px}
</style>
</head>
<body>

<h2>LED Aquarium Controller</h2>
<div id="modeStatus">MODE: -</div>

<div class="section">
<h3>Mode</h3>
<button onclick="setMode('manual')">Manual</button>
<button onclick="setMode('auto')">Auto</button>
</div>

<div class="section">
<h3>Auto Level (%)</h3>
06.30 <input id="a1" type="number" min="0" max="100"><br>
07.31 <input id="a2" type="number" min="0" max="100"><br>
09.01 <input id="a3" type="number" min="0" max="100"><br>
13.01 <input id="a4" type="number" min="0" max="100"><br>
14.31 <input id="a5" type="number" min="0" max="100"><br><br>
<button onclick="saveAuto()">SAVE AUTO</button>
<div id="autoStatus"></div>
</div>

<script>
const client = mqtt.connect('wss://broker.emqx.io:8084/mqtt');

client.on('connect',()=>{
 client.subscribe('status/mode');
 client.subscribe('status/auto');
});

client.on('message',(topic,message)=>{
 const msg=message.toString();

 if(topic==='status/mode'){
  document.getElementById('modeStatus').innerText="MODE: "+msg;
 }

 if(topic==='status/auto'){
  document.getElementById('autoStatus').innerText=msg;
 }
});

function setMode(mode){
 client.publish('mode',mode);
}

function saveAuto(){
 for(let i=1;i<=5;i++){
   let val=parseInt(document.getElementById('a'+i).value);
   if(isNaN(val)) val=0;
   val=Math.min(100,Math.max(0,val));
   client.publish('auto/set'+i,Math.round(val*2.55).toString());
 }
 client.publish('auto/save','1');
}
</script>

</body>
</html>
